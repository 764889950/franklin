<!DOCTYPE html>
<!-- vim: set foldmethod=marker : -->
<html>
	<head> <!-- {{{ -->
		<meta http-equiv='Content-type: text/html;charset=utf-8'/>
		<title>MOST RepRap printer interface</title>
		<script type='application/javascript' src='rpc.js'></script>
		<script type='application/javascript' src='server.js'></script>
		<script type='application/javascript' src='index.js'></script>
		<style type='text/css'></style>
		<link rel='stylesheet' href='index.css'/>
	</head> <!-- }}} -->
	<body onload='init ()' id='container' class='noexpert notweak nosetup nomover'>
		<div id='templates'> <!-- {{{ -->
			<div id='Label'> <!-- {{{ -->
				<div class='tab' onclick='select_printer (this.port)'>
					[!(
						node.port = args[0],
						printer ? [printer.name].concat (elements) : elements
						<span class='port setup'>[!('@' + args[0])!]</span>
					)!]
				</div>
			</div> <!-- }}} -->
			<!-- Primitives {{{ -->
			<div id='Button'> <!-- {{{ -->
				[!(
				// args = title, action, class
				//elements[0].id = make_id (printer, [null, args[1]]),
				elements[0].action = args[1],
				args[2] ? elements[0].AddClass (args[2]) : 0,
				elements[0].printer = printer,
				elements[0].AddText (args[0]),
				elements
				<button class='wide title' type='button' onclick='this.printer.call (this.action, [], {})'></button>
				)!]
			</div> <!-- }}} -->
			<div id='Text'> <!-- {{{ -->
				[!(
				// args = title, obj, class
				elements[1].id = make_id (printer, args[1], 'source'),
				elements[2].source = elements[1].id,
				elements[2].obj = args[1],
				args[2] ? elements[0].AddClass (args[2]) : 0,
				args[2] ? elements[1].AddClass (args[2]) : 0,
				args[2] ? elements[2].AddClass (args[2]) : 0,
				elements[2].printer = printer,
				elements[0].AddText (args[0]),
				elements
				<span class='blocktitle'></span>
				<input type='text' class='title'/>
				<button class='button title' type='button' onclick='set_value (this.printer, this.obj, document.getElementById (this.source).value)'>Set</button>
				)!]
			</div> <!-- }}} -->
			<div id='Range'> <!-- {{{ -->
				[!(
				// args = title, max, obj, class
				elements[0].id = make_id (printer, args[2]),
				elements[1].source = elements[0].id,
				elements[1].obj = args[2],
				elements[1].printer = printer,
				[make_tablerow (args[0], [elements], ['rowtitle', args[3]])]
				<select>[!(range (args[1], elements[0], 'value')<option></option>)!]</select>
				<button class='button' type='button' onclick='set_value (this.printer, this.obj, document.getElementById (this.source).selectedIndex)'>Set</button>
				)!]
			</div> <!-- }}} -->
			<div id='Choice'> <!-- {{{ -->
				[!(
				// args = obj, options, class[es], containerclasses
				choice (args[0], args[1], elements[0], elements[1], args[2], args[3])
				<input type='radio'/>
				<label></label>
				)!]
			</div> <!-- }}} -->
			<div id='Pin'> <!-- {{{ -->
				[!(
				// args = title, obj, only_analog
				elements[0].id = make_id (printer, args[1]),
				elements[0].obj = args[1],
				elements[0].printer = printer,
				elements[1].id = make_id (printer, args[1], 'invalid'),
				elements[2].htmlFor = elements[1].id,
				elements[3].id = make_id (printer, args[1], 'inverted'),
				elements[4].htmlFor = elements[3].id,
				elements[5].printer = printer,
				elements[5].addEventListener ('click', function () { set_pin (this.printer, args[1]); }, false),
				args[2] ? (elements[3].AddClass ('hidden'), elements[4].AddClass ('hidden')) : 0,
				[make_tablerow (args[0], [[elements[0]], [elements[1], elements[2]], [elements[3], elements[4]], [elements[5]]], ['pintitle', 'pinvalue'])]
				<select class='pinselect'>[!(pinrange (args[2], elements[0], 'value')<option></option>)!]</select>
				<input type='checkbox'/>
				<label>Invalid</label>
				<input type='checkbox'/>
				<label>Inverted</label>
				<button class='button' type='button'>Set</button>
				)!]
			</div> <!-- }}} -->
			<div id='Float'> <!-- {{{ -->
				[!(
				// args = obj, factor, class
				elements[2].id = make_id (printer, args[0]),
				elements[0].id = make_id (printer, args[0], 'new'),
				elements[0].factor = args[1] ? args[1] : 1,
				elements[1].factor = elements[0].factor,
				elements[2].factor = elements[0].factor,
				elements[1].source = elements[0].id,
				elements[1].obj = args[0],
				elements[1].printer = printer,
				args[2] ? elements[0].AddClass (args[2]) : 0,
				args[2] ? elements[1].AddClass (args[2]) : 0,
				args[2] ? elements[2].AddClass (args[2]) : 0,
				stack
				<input type='text'/>
				<button class='button' type='button' onclick='set_value (this.printer, this.obj, this.factor * Number (document.getElementById (this.source).value))'>Set</button>
				<span></span>
				)!]
			</div> <!-- }}} -->
			<div id='Toggle'> <!-- {{{ -->
				[!(
				// args = title, obj, oncommand, offcommand, ontext, offtext, class
				elements[1].AddText (args[2]),
				elements[2].AddText (args[3]),
				elements[3].value = [args[5], args[4]],
				elements[3].id = make_id (printer, args[1]),
				elements[1].obj = args[1],
				elements[2].obj = args[1],
				elements[1].printer = printer,
				elements[2].printer = printer,
				elements[1].addEventListener ('click', function () { set_value (this.printer, this.obj, true); }, false),
				elements[2].addEventListener ('click', function () { set_value (this.printer, this.obj, false); }, false),
				elements[0].AddText (args[0]),
				args[6] ? elements[0].AddClass (args[6]) : 0,
				args[6] ? elements[1].AddClass (args[6]) : 0,
				args[6] ? elements[2].AddClass (args[6]) : 0,
				args[6] ? elements[3].AddClass (args[6]) : 0,
				stack
				<span class='blocktitle'></span>
				<button type='button' class='title'></button>
				<button type='button' class='title'></button>
				<span class='title'></span>
				)!]
			</div> <!-- }}} -->
			<div id='File'> <!-- {{{ -->
				[!(
				// args = title, obj, class
				args[2] ? elements[0].AddClass (args[2]) : 0,
				args[2] ? elements[1].AddClass (args[2]) : 0,
				args[2] ? elements[2].AddClass (args[2]) : 0,
				elements[1].id = make_id (printer, args[1]),
				elements[2].source = args[1],
				elements[2].printer = printer,
				elements[2].extra = (args[3] ? args[3] : function() {}),
				elements[0].AddText (args[0]),
				stack
				<span class='blocktitle'></span>
				<input type='file' class='title'/>
				<button class='button title' type='button' onclick='set_file (this.printer, this.source); this.extra()'>Upload</button>
				)!]
			</div> <!-- }}} -->
			<div id='Run'> <!-- {{{ -->
				[!(
				// args = obj, class
				elements[0].id = make_id (printer, args[0], 'minus'),
				elements[2].id = make_id (printer, args[0], 'plus'),
				elements[4].id = make_id (printer, args[0], 'value'),
				elements[1].htmlFor = elements[0].id,
				elements[3].htmlFor = elements[2].id,
				elements[0].printer = printer,
				elements[2].printer = printer,
				elements[0].obj = args[0],
				elements[2].obj = args[0],
				elements[0].factor = -1,
				elements[2].factor = 1,
				elements[0].other = elements[2],
				elements[2].other = elements[0],
				elements[0].addEventListener ('click', function () { this.other.checked = false; this.printer.call ('run_' + this.obj[0][0], [this.obj[1], this.checked ? this.factor * Number (get_element (this.printer, this.obj, 'value').value) : NaN], {}); }, false),
				elements[2].addEventListener ('click', function () { this.other.checked = false; this.printer.call ('run_' + this.obj[0][0], [this.obj[1], this.checked ? this.factor * Number (get_element (this.printer, this.obj, 'value').value) : NaN], {}); }, false),
				args[1] ? elements[0].AddClass (args[1]) : 0,
				args[1] ? elements[1].AddClass (args[1]) : 0,
				args[1] ? elements[2].AddClass (args[1]) : 0,
				args[1] ? elements[3].AddClass (args[1]) : 0,
				args[1] ? elements[4].AddClass (args[1]) : 0,
				stack
				<input type='checkbox' class='run1'/>
				<label class='run2'>-</label>
				<input type='checkbox' class='run1'/>
				<label class='run2'>+</label>
				<input type='text' class='run3' value='Infinity'/>
				)!]
			</div> <!-- }}} -->
			<!-- }}} -->
			<div id='Motor'> <!-- {{{ -->
				<!-- args = parent, index, basic_steps -->
				<div>[$(Run [[[args[0], 'motor'], args[1]], args[2] ? '' : 'expert'])$]</div>
				<div>[$(Float [[[[args[0], 'motor'], args[1]], 'steps_per_mm'], 1, args[2] ? '' : 'expert'])$]</div>
				<div>[$(Float [[[[args[0], 'motor'], args[1]], 'limit_v'], 1, 'setup'])$]</div>
				<div>[$(Float [[[[args[0], 'motor'], args[1]], 'max_steps'], 1, 'setup'])$]</div>
				<!--sleeping.-->
			</div> <!-- }}} -->
			<div id='Temp_components'> <!-- {{{ -->
				<!-- args = parent, index -->
				<div>[$(Float [[[args[0], args[1]], 'R0'], 1000, 'expert'])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'R1'], 1000, 'expert'])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'Rc'], 1000, 'expert'])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'Tc'], 1, 'expert'])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'beta'], 1, 'expert'])$]</div>
			</div> <!-- }}} -->
			<div id='Temp_calibration'> <!-- {{{ -->
				<!-- args = parent, index -->
				<div>[$(Float [[[args[0], args[1]], 'core_C'], 1, 'expert'])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'shell_C'], 1, 'expert'])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'transfer'], 1, 'expert'])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'radiation'], 1, 'expert'])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'power'], 1, 'expert'])$]</div>
			</div> <!-- }}} -->
			<div id='Temp_control'> <!-- {{{ -->
				<div>[$(Float [[[args[0], args[1]], 'value', 'settemp']])$]</div>
				<div>[!(
					// args = obj, index
					//elements[1].id = make_id (printer, [[args[0], args[1]], 'current']),
					elements[0].target = elements[1],
					elements[0].printer = printer,
					elements[0].addEventListener ('click', function () {
						var target = this.target;
						this.printer.call ('readtemp_' + (typeof args[0] == 'string' ? args[0] : args[0][0]), [args[1]], {}, function (value) {
							target.ClearAll ();
							target.AddText (value.toFixed (1));
						});
					}, false),
					elements
					<button>Refresh</button>
					<span></span>
				)!]</div>
				<!-- current -->
			</div> <!-- }}} -->

			<div id='Motor_axis'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow (axis_name (args[0], false), elements, ['rowtitle', args[1]], 'expert')]
				[$(Motor ['axis', args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Limits_axis'> <!-- {{{ -->
				[!(
				// args = index
				[make_tablerow (axis_name (args[0], true), elements, ['rowtitle setup', ['setup', 'setup delta', 'setup delta']], 'setup')]
				<div>[$(Float [[['axis', args[0]], 'park'], 1, 'setup'])$]</div>
				<div>[$(Float [[['axis', args[0]], 'axis_min'], 1, 'setup'])$]</div>
				<div>[$(Float [[['axis', args[0]], 'axis_max'], 1, 'setup'])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Delta_axis'> <!-- {{{ -->
				[!(
				// args = index
				[make_tablerow (axis_name (args[0], false), elements, ['rowtitle expert', ['setup', 'setup', 'setup', 'setup delta', 'setup delta']], 'expert')]
				<div>[$(Float [[['axis', args[0]], 'limit_pos'], 1, 'setup'])$]</div>
				<div>[$(Float [[['axis', args[0]], 'motor_min'], 1, 'setup'])$]</div>
				<div>[$(Float [[['axis', args[0]], 'motor_max'], 1, 'setup'])$]</div>
				<div>[$(Float [[['axis', args[0]], 'delta_length'], 1, 'setup delta'])$]</div>
				<div>[$(Float [[['axis', args[0]], 'delta_radius'], 1, 'setup delta'])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Move_axis'> <!-- {{{ -->
				[!(
				// args = index
				elements[1].id = make_id (printer, [['axis', args[0]], 'goto']),
				elements[2].printer = printer,
				elements[2].index = args[0],
				elements[2].addEventListener ('click', function () {
					var target = new Object;
					target[String (args[0])] = Number (get_element (this.printer, [['axis', this.index], 'goto']).value);
					this.printer.call ('goto', [target], {});
				}, false),
				[make_tablerow (axis_name (args[0], true), [[elements[1], elements[2]], elements[0], elements[3], elements[4]], ['rowtitle', ''])]
				<div>[$(Float [[['axis', args[0]], 'offset'], 1, (args[0] != 2 ? 'expert' : 'tweak')])$]</div>
				<input type='text'/>
				<button class='button' type='button'>Go</button>
				<div>[$(Float [[[['axis', 'motor'], args[0]], 'max_v'], 1, 'expert'])$]</div>
				<div>[$(Float [[[['axis', 'motor'], args[0]], 'max_a'], 1, 'expert'])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Pins_axis'> <!-- {{{ -->
				[!(
				make_pin_title (axis_name (args[0], false), stack)
				[$(Pin ['Step', [[['axis', 'motor'], args[0]], 'step_pin']])$]
				[$(Pin ['Dir', [[['axis', 'motor'], args[0]], 'dir_pin']])$]
				[$(Pin ['Enable', [[['axis', 'motor'], args[0]], 'enable_pin']])$]
				[$(Pin ['Min limit', [['axis', args[0]], 'limit_min_pin']])$]
				[$(Pin ['Max limit', [['axis', args[0]], 'limit_max_pin']])$]
				[$(Pin ['Sense', [['axis', args[0]], 'sense_pin']])$]
				)!]
			</div> <!-- }}} -->
			<div id='Motor_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow (extruder_name (args[0]), elements, ['rowtitle', args[1]])]
				[$(Motor ['extruder', args[0], true])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_components_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow (extruder_name (args[0]), elements, ['rowtitle', args[1]], 'expert')]
				[$(Temp_components [['extruder', 'temp'], args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_calibration_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow (extruder_name (args[0]), elements, ['rowtitle', args[1]], 'expert')]
				[$(Temp_calibration [['extruder', 'temp'], args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_control_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow (extruder_name (args[0]), elements, ['rowtitle', args[1]])]
				[$(Temp_control [['extruder', 'temp'], args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Setup_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				elements[0].id = make_id (printer, [['extruder', args[0]], 'move']),
				elements[1].printer = printer,
				elements[1].index = args[0],
				elements[1].addEventListener ('click', function () {
					var value = Number (get_element (this.printer, [['extruder', this.index], 'move']).value);
					this.printer.call ('goto', [], {e: value, which: this.index});
				}, false),
				elements[2].printer = printer,
				elements[2].index = args[0],
				elements[2].addEventListener ('click', function () {
					var value = Number (get_element (this.printer, [['extruder', this.index], 'move']).value);
					this.printer.call ('goto', [], {e: -value, which: this.index});
				}, false),
				[make_tablerow (extruder_name (args[0]), [[elements[0], elements[1], elements[2]], elements[3], elements[4]], ['rowtitle', args[1]])]
				<input type='text'/>
				<button class='button' type='button'>Extrude</button>
				<button class='button' type='button'>Retract</button>
				<div>[$(Float [[[['extruder', 'motor'], args[0]], 'max_v'], 1, 'expert'])$]</div>
				<div>[$(Float [[[['extruder', 'motor'], args[0]], 'max_a'], 1, 'expert'])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Pins_extruder'> <!-- {{{ -->
				[!(
				// args = index, visible
				node.id = make_id (printer, [['extruderpins', args[0]], 'container']),
				make_pin_title (extruder_name (args[0]), stack)
				[$(Pin ['Step', [[['extruder', 'motor'], args[0]], 'step_pin']])$]
				[$(Pin ['Direction', [[['extruder', 'motor'], args[0]], 'dir_pin']])$]
				[$(Pin ['Enable', [[['extruder', 'motor'], args[0]], 'enable_pin']])$]
				[$(Pin ['Power', [[['extruder', 'temp'], args[0]], 'power_pin']])$]
				[$(Pin ['Thermistor', [[['extruder', 'temp'], args[0]], 'thermistor_pin'], true])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_components_temp'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow (temp_name (args[0]), elements, ['rowtitle', args[1]], 'expert')]
				[$(Temp_components ['temp', args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_calibration_temp'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow (temp_name (args[0]), elements, ['rowtitle', args[1]], 'expert')]
				[$(Temp_calibration ['temp', args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_control_temp'> <!-- {{{ -->
				[!(
				// args = index
				[make_tablerow (temp_name (args[0]), elements, ['rowtitle', args[1]])]
				[$(Temp_control ['temp', args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Pins_temp'> <!-- {{{ -->
				[!(
				// args = index, visible
				node.id = make_id (printer, [['temppins', args[0]], 'container']),
				make_pin_title (temp_name (args[0]), stack)
				[$(Pin ['Power', [['temp', args[0]], 'power_pin']])$]
				[$(Pin ['Thermistor', [['temp', args[0]], 'thermistor_pin'], true])$]
				)!]
			</div> <!-- }}} -->
			<div id='Gpio_gpio'> <!-- {{{ -->
				[!(
				// args = index, visible
				elements[1].id = make_id (printer, [['gpio', args[0]], 'master']),
				elements[2].index = args[0],
				elements[2].printer = printer,
				[make_tablerow (gpio_name (args[0]), [elements[0], [elements[1], elements[2]], elements[3]], ['rowtitle', args[1]], undefined, [['gpio', args[0]], 'state'])]
				<div>[$(Choice [[['gpio', args[0]], 'state'], ['Off', 'On', 'Pulled up', 'High Z'], ['', '', 'expert', 'expert']])$]</div>
				<select class='expert'>[!(temprange (elements[0], 'value')<option></option>)!]</select>
				<button class='button expert' type='button' onclick='set_gpio_master (this.printer, this.index)'>Set</button>
				<div>[$(Float [[['gpio', args[0]], 'value'], 1, 'expert'])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Pins_gpio'> <!-- {{{ -->
				[!(
				// args = index, visible
				node.id = make_id (printer, [['gpiopins', args[0]], 'container']),
				make_pin_title (gpio_name (args[0]), stack)
				[$(Pin ['Pin', [['gpio', args[0]], 'pin']])$]
				)!]
			</div> <!-- }}} -->

			<div id='Printer'> <!-- {{{ -->
				// TODO: upload script, see printing state, command feedback.
				<div class='printer'>
					[!(
						node.id = make_id (printer, [null, 'container']),
						elements[0].id = make_id(printer, [null, 'block1']),
						elements
						<div class='hidden blocker'></div>
					)!]
					<div class='setup'>[!(elements[0].port = port, elements<button type='button' onclick="rpc.call ('disable', [this.port], {})">Disable printer</button>)!]</div>
					<div> <!-- {{{ Queue. -->
						<div>[$(File ['Add to queue', [null, 'queue_add', 'queue_add'], undefined, queue_deselect])$]</div>
						<div>
							[!(
								elements[0].id = make_id (printer, [null, 'queue']),
								elements
								<select multiple='multiple'></select>
								<div class='queuelist'>
									<button type='button' onclick='queue_up ()'>&#x2b06;</button>
									<button type='button' onclick='queue_del ()'>Remove selected</button><br/>
									<button type='button' onclick='queue_down ()'>&#x2b07;</button>
									<button type='button' onclick='quick_print ()'>Print selected at center</button><br/>
									<button type='button' onclick='start_move ()'>Position selected and print</button>
								</div>
							)!]
						</div>
					</div> <!-- }}} -->
					[!(
						elements[0].id = make_id (printer, [null, 'scripts']),
						elements
						<div></div>
					)!]
					<div class='setup'>[$(Text ['Name', [null, 'name'], 'setup'])$]</div>
					<div class='tweak'>[$(Button ['Sleep', 'sleep_all'])$]</div>
					<div class='tweak'><button type='button' onclick="selected_printer.call ('home', [], {}, update_canvas_and_spans)">Home</button></div>
					<div>[$(Toggle ['Pause', [null, 'paused', 'pause'], 'Pause', 'Resume', 'Paused', ''])$]</div>

					<table class='tweak'>
						<tr>
							<th class='blocktitle'>Settings</th>
							<th class='floattitle tweak'>Feedrate (%)</th>
							<th class='floattitle setup'>Angle</th>
							<th class='choicetitle setup'>Printer type</th>
							<th class='floattitle expert'>Motor timeout (s)</th>
							<th class='floattitle expert'>Temp timeout (s)</th>
						</tr>
						<tr>
							<th class='rowtitle'>&nbsp;</th>
							<td class='tweak'>[$(Float [[null, 'feedrate'], .01])$]</td>
							<td class='setup'>[$(Float [[null, 'angle'], 1])$]</td>
							<td class='setup'>[$(Choice [[null, 'printer_type'], ['Cartesian', 'Delta'], undefined, ['nodelta', null]])$]</td>
							<td class='expert'>[$(Float [[null, 'motor_limit'], 1000])$]</td>
							<td class='expert'>[$(Float [[null, 'temp_limit'], 1000])$]</td>
						</tr>
					</table>

					[!([make_table (
						build ('Range', ['Axes', printer.maxaxes, [null, 'num_axes'], 'setup']),
						build ('Range', ['Extruders', printer.maxextruders, [null, 'num_extruders'], 'setup']),
						build ('Range', ['Temps', printer.maxtemps, [null, 'num_temps'], 'setup']),
						build ('Range', ['Gpios', printer.maxgpios, [null, 'num_gpios'], 'setup'])
					).AddClass ('setup')])!]

					[!([make_table (
						multiple_titles ([[], ['extruder'], ['axis'], []], [
							'Motors',
							'Run',
							'Steps per mm',
							'v limit (mm/s)',
							'Max steps'
						], [
							'blocktitle',
							'floattitle',
							'floattitle',
							'floattitle setup',
							'floattitle setup'
						], [
							null,
							'Unlimited move.',
							'Set the (micro)steps that the motor needs to do to move the hardware by one mm.',
							'Maximum speed that the motor is allowed to move.',
							'Maximum number of steps to do in one iteration; set to number of microsteps.'
						]),
					multiple ('Motor_axis', 'expert'),
					multiple ('Motor_extruder')
					).AddClass ('tweak')])!]

					[!([make_table (
						multiple_titles ([[], ['axis'], [], []], [
							'Axis move',
							'Go (mm)',
							'Offset (mm)',
							'Max v (mm/s)',
							'Max a (mm/s²)'
						], [
							'blocktitle',
							'inputtitle tweak',
							'floattitle tweak',
							'floattitle expert',
							'floattitle expert'
						], [
							null,
							'Physically move the extruder to this position.  For Z, more positive numbers move the extruder away from the bed.',
							'Displacement of origin.  When instructed to go to a position, it will add this value to the position before going there.',
							'Maximum speed that the axis will try to move.',
							'Maximum acceleration that the axis is trying to use while speeding up or slowing down.'
						]),
						multiple ('Move_axis')
					).AddClass ('tweak')])!]

					[!([make_table (
						multiple_titles ([[], ['extruder'], [], []], [
							'Extruder setup',
							'Extrude (mm)',
							'Max v (mm/s)',
							'Max a (mm/s²)'
						], [
							'blocktitle',
							'inputtitle tweak',
							'floattitle expert',
							'floattitle expert'
						], [
							null,
							'Extrude or retract a length of filament.',
							'Maximum speed that the extruder will try to move.',
							'Maximum acceleration that the extruder is trying to use while speeding up or slowing down.'
						]),
						multiple ('Setup_extruder', ['tweak', 'expert', 'expert'])
					).AddClass ('tweak')])!]

					[!([make_table (
						multiple_titles ([['extruder', 'temp'], [], [], []], [
							'Temp control',
							'Target (°C)',
							'Current (°C)'
						], [
							'blocktitle',
							'floattitle',
							'floattitle'
						], [
							null,
							'Temperature target.  Set to NaN to disable the heater completely.',
							'Request actual temperature from sensor.'
						]),
						multiple ('Temp_control_extruder'),
						multiple ('Temp_control_temp')
					).AddClass ('tweak')])!]

					[!([make_table (
						multiple_titles ([[], ['gpio'], [], []], [
							'Gpio',
							'State',
							'Master temp',
							'Treshold (°C)'
						], [
							'blocktitle',
							'choicetitle tweak',
							'inputtitle expert',
							'floattitle expert'
						], [
							null,
							'State of the pin.  High Z and Pulled up both set the pin to input; the latter enables the pull-up resistor.',
							'If set to something other than None, the pin will automatically be set and reset depending on the value of the selected temperature control.',
							'If a master temp is set, the pin will be on if that temp is above this value, otherwise it will be off.'
						]),
						multiple ('Gpio_gpio')
					).AddClass('tweak')])!]

					[!([make_table (
						multiple_titles ([[], [], [], ['axis']], [
							'Axis limits',
							'Park pos (mm)',
							'Axis min (mm)',
							'Axis max (mm)'
						], [
							'blocktitle',
							'floattitle setup',
							'floattitle setup delta',
							'floattitle setup delta'
						], [
							null,
							'Park position of the axis.',
							'Minimum value that the axis may move to.',
							'Maximum value that the axis may move to.'
						]),
						multiple ('Limits_axis')
					).AddClass ('setup')])!]

					[!([make_table (
						multiple_titles ([[], [], [], ['axis']], [
							'Motor settings',
							'Switch pos (mm)',
							'Motor min (mm)',
							'Motor max (mm)',
							'Rod length (mm)',
							'Radius (mm)'
						], [
							'blocktitle',
							'floattitle setup',
							'floattitle setup',
							'floattitle setup',
							'floattitle setup delta',
							'floattitle setup delta'
						], [
							null,
							'Position of the limit switch.',
							'Minimum value that the motor may move to. (Normally 0.)',
							'Maximum value that the motor may move to. (Normally equal to rod length.)',
							'Length of the tie rods, measured between the pivot points.',
							'Horizontal distance between the pivot points of the tie rods.  Note that this value does not include the effector or carriage offsets.'
						]),
						multiple ('Delta_axis')
					).AddClass ('setup')])!]

					[!([make_table (
						multiple_titles ([[], [], [], ['extruder', 'temp']], [
							'Temp components',
							'R0 (kΩ)',
							'R1 (kΩ)',
							'Rc (kΩ)',
							'Tc (°C)',
							'β (1)'
						], [
							'blocktitle setup',
							'floattitle setup',
							'floattitle setup',
							'floattitle setup',
							'floattitle setup',
							'floattitle setup'
						], [
							null,
							'Resistance on the board in series with the thermistor.  Normally 4.7 or 10.',
							'Resistance on the board in parallel with the thermistor.  Normally Infinity.',
							'Calibrated resistance of the thermistor.  Normally 100 for extruders, 10 for the heated bed.',
							'Temperature at which the thermistor has value Rc.  Normally 20.',
							"Temperature dependence of the thermistor.  Normally around 3800.  It can be found in the thermistor's data sheet."
						]),
						multiple ('Temp_components_extruder', 'setup'),
						multiple ('Temp_components_temp', 'setup')
					).AddClass ('setup')])!]

					[!([make_table (elements[0], elements[1],
						multiple ('Pins_axis'),
						multiple ('Pins_extruder'),
						multiple ('Pins_temp'),
						multiple ('Pins_gpio')).AddClass ('setup')]
						[$(Pin ['LED', [null, 'led_pin']])$]
						[$(Pin ['Probe', [null, 'probe_pin']])$]
					)!]
					[$(Button ['Save settings to EEPROM', 'save_all', 'expert'])$]
					[$(Button ['Restore settings from EEPROM', 'load_all', 'expert'])$]
					<div class='tweak'>[$(File ['Import settings from file', [null, 'import', 'import_settings']])$]</div>
					<div class='tweak'>[!(
						elements[0].id = make_id (printer, [null, 'export']),
						stack
						<a class='title' title='Save settings to disk.'>Export settings to file</a>
					)!]</div>
					[!(
						elements[0].id = make_id(printer, [null, 'status1']),
						elements
						<div class='status'></div>
					)!]
				</div>
			</div> <!-- }}} -->
			<div id='NoPrinter'> <!-- {{{ -->
				<div class='noprinter notconnected setup'>
					[!(
						node.id = make_id ({'port': args[0]}, [null, 'nocontainer']),
						elements[0].id = make_id({'port': args[0]}, [null, 'block2']),
						elements
						<div class='hidden blocker'></div>
					)!]
					<h2>No printer is found on this port.</h2>
					<p>
						If autodetect does not work, you can request to detect a printer:
						[!(
							elements[0].port = args[0],
							elements
							<button type='button' onclick='rpc.call ("detect", [this.port], {});'>Detect</button>
						)!]
					</p>
					<p>
						Or you can upload the firmware that fits your hardware.
						[!(upload_buttons (args[0], [['melzi', '1284p (Melzi, Sanguinololu)'], ['ramps', 'mega2560 (Ramps)'], ['mega', 'mega']]))!]
					</p>
					[!(
						elements[0].id = make_id({'port': args[0]}, [null, 'status2']),
						elements
						<div class='status'></div>
					)!]
				</div>
			</div> <!-- }}} -->
		</div> <!-- }}} -->
		<div id='showswitches'> <!-- {{{ -->
			<div>
				<label for='tweakbox'>Show tweak settings</label>
				<input type='checkbox' id='tweakbox' selected='selected' onclick='switch_show (this.checked, "tweak")'/>
			</div>
			<div class='tweak'>
				<label for='expertbox'>Show expert settings</label>
				<input type='checkbox' id='expertbox' onclick='switch_show (this.checked, "expert")'/>
			</div>
			<div class='expert'>
				<label for='setupbox'>Show setup settings</label>
				<input type='checkbox' id='setupbox' onclick='switch_show (this.checked, "setup")'/>
			</div>
		</div> <!-- }}} -->
		<div id='labels'></div>
		<div id='printers'></div>
		<div id='debug'></div>
		<div id='scripts'></div>
		<div id='movediv' onkeydown='if (!key_move (event.keyCode, event.shiftKey, event.ctrlKey)) event.preventDefault ()'><!-- {{{ -->
			<div id='movebox'>
				<p>Amount per keypress: <input value='10' class='title' type='text' id='move_amount'/></p>
				<p>Move X and Y with cursor keys, Z with Page Up/Down.  Shift to move small steps.<br/>
				Use number pad to choose reference point.  Ctrl to do so without moving the nozzle.<br/>
				Press enter and choose a new reference to set rotation.<br/>
				Press Esc to go back.</p>
				<div id='move_viewbox'><canvas id='move_view'></canvas></div>
				<p>Current position: <span id='move_span_0'></span>, <span id='move_span_1'></span>, <span id='move_span_2'></span> mm</p>
				<p>
					<button type='button' onclick='queue_print ()'>Print here</button>
					<button type='button' class='expert' onclick='queue_mill ()'>Probe and mill here</button>
					<button type='button' class='tweak' onclick="selected_printer.call ('home', [], {}, update_canvas_and_spans)">Home</button>
					<button type='button' onclick="selected_printer.call ('park', [], {}, update_canvas_and_spans)">Park</button>
					<button type='button' class='tweak' onclick="selected_printer.call ('home', [[2]], {}, update_canvas_and_spans)">Home Z</button>
					<button type='button' class='tweak' onclick="reset_position ()">Reset position</button>
					<button type='button' onclick="selected_printer.call ('pause', [true], {})">Stop</button>
				</p>
			</div>
		</div><!-- }}} -->
	</body>
</html>
