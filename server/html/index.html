<!DOCTYPE html>
<!-- vim: set foldmethod=marker : -->
<html>
	<head> <!-- {{{ -->
		<meta http-equiv='Content-type: text/html;charset=utf-8'/>
		<title>MOST RepRap printer interface</title>
		<script type='application/javascript' src='rpc.js'></script>
		<script type='application/javascript' src='server.js'></script>
		<script type='application/javascript' src='index.js'></script>
		<style type='text/css'></style>
		<link rel='stylesheet' href='index.css'/>
	</head> <!-- }}} -->
	<body onload='init()' id='container' class='nosetup'>
		<div id='templates'> <!-- {{{ -->
			<div id='Label'> <!-- {{{ -->
				<div class='tab' onclick='select_printer(this.port)'>
					[!(
						node.port = args[0],
						printer ? [printer.name].concat(elements) : elements
						<span class='port setup'>[!('@' + args[0])!]</span>
					)!]
				</div>
			</div> <!-- }}} -->
			<!-- Primitives {{{ -->
			<div id='Button'> <!-- {{{ -->
				[!(
				// args = title, action, class
				//elements[0].id = make_id(printer, [null, args[1]]),
				elements[0].action = args[1],
				args[2] ? elements[0].AddClass(args[2]) : 0,
				elements[0].printer = printer,
				elements[0].AddText(args[0]),
				elements
				<button class='wide title' type='button' onclick='this.printer.call(this.action, [], {})'></button>
				)!]
			</div> <!-- }}} -->
			<div id='Text'> <!-- {{{ -->
				[!(
				// args = title, obj, class
				elements[1].id = make_id(printer, args[1], 'source'),
				elements[2].source = elements[1].id,
				elements[2].obj = args[1],
				args[2] ? elements[0].AddClass(args[2]) : 0,
				args[2] ? elements[1].AddClass(args[2]) : 0,
				args[2] ? elements[2].AddClass(args[2]) : 0,
				elements[2].printer = printer,
				elements[0].AddText(args[0]),
				elements
				<span class='blocktitle'></span>
				<input type='text' class='title'/>
				<button class='button title' type='button' onclick='set_value(this.printer, this.obj, document.getElementById(this.source).value)'>Set</button>
				)!]
			</div> <!-- }}} -->
			<div id='Range'> <!-- {{{ -->
				[!(
				// args = title, max, obj, class
				elements[0].id = make_id(printer, args[2]),
				elements[1].source = elements[0].id,
				elements[1].obj = args[2],
				elements[1].printer = printer,
				[make_tablerow(args[0], [elements], ['rowtitle1', args[3]])]
				<select>[!(range(args[1], elements[0], 'value')<option></option>)!]</select>
				<button class='button' type='button' onclick='set_value(this.printer, this.obj, document.getElementById(this.source).selectedIndex)'>Set</button>
				)!]
			</div> <!-- }}} -->
			<div id='Choice'> <!-- {{{ -->
				[!(
				// args = obj, options, class[es], containerclasses
				choice(args[0], args[1], elements[0], elements[1], args[2], args[3])
				<input type='radio'/>
				<label></label>
				)!]
			</div> <!-- }}} -->
			<div id='Pin'> <!-- {{{ -->
				[!(
				// args = title, obj, only_analog
				elements[0].id = make_id(printer, args[1]),
				elements[0].obj = args[1],
				elements[0].printer = printer,
				elements[1].id = make_id(printer, args[1], 'valid'),
				elements[2].htmlFor = elements[1].id,
				elements[3].id = make_id(printer, args[1], 'inverted'),
				elements[4].htmlFor = elements[3].id,
				elements[5].printer = printer,
				elements[5].addEventListener('click', function() { set_pin(this.printer, args[1]); }, false),
				args[2] ? (elements[3].AddClass('hidden'), elements[4].AddClass('hidden')) : 0,
				[make_tablerow(args[0], [[elements[0]], [elements[1], elements[2]], [elements[3], elements[4]], [elements[5]]], ['pintitle', 'pinvalue'])]
				<select class='pinselect'>[!(pinrange(args[2], elements[0], 'value')<option></option>)!]</select>
				<input type='checkbox'/>
				<label>Valid</label>
				<input type='checkbox'/>
				<label>Inverted</label>
				<button class='button' type='button'>Set</button>
				)!]
			</div> <!-- }}} -->
			<div id='Float'> <!-- {{{ -->
				[!(
				// args = obj, factor, class
				elements[2].id = make_id(printer, args[0]),
				elements[0].id = make_id(printer, args[0], 'new'),
				elements[0].factor = args[1] ? args[1] : 1,
				elements[1].factor = elements[0].factor,
				elements[2].factor = elements[0].factor,
				elements[1].source = elements[0].id,
				elements[1].obj = args[0],
				elements[1].printer = printer,
				args[2] ? elements[0].AddClass(args[2]) : 0,
				args[2] ? elements[1].AddClass(args[2]) : 0,
				args[2] ? elements[2].AddClass(args[2]) : 0,
				stack
				<input type='text'/>
				<button class='button' type='button' onclick='set_value(this.printer, this.obj, this.factor * Number(document.getElementById(this.source).value))'>Set</button>
				<span></span>
				)!]
			</div> <!-- }}} -->
			<div id='Toggle'> <!-- {{{ -->
				[!(
				// args = title, obj, oncommand, offcommand, ontext, offtext, class
				elements[1].AddText(args[2]),
				elements[2].AddText(args[3]),
				elements[3].value = [args[5], args[4]],
				elements[3].id = make_id(printer, args[1]),
				elements[1].obj = args[1],
				elements[2].obj = args[1],
				elements[1].printer = printer,
				elements[2].printer = printer,
				elements[1].addEventListener('click', function() { set_value(this.printer, this.obj, true); }, false),
				elements[2].addEventListener('click', function() { set_value(this.printer, this.obj, false); }, false),
				elements[0].AddText(args[0]),
				args[6] ? elements[0].AddClass(args[6]) : 0,
				args[6] ? elements[1].AddClass(args[6]) : 0,
				args[6] ? elements[2].AddClass(args[6]) : 0,
				args[6] ? elements[3].AddClass(args[6]) : 0,
				stack
				<span class='blocktitle'></span>
				<button type='button' class='title'></button>
				<button type='button' class='title'></button>
				<span class='title'></span>
				)!]
			</div> <!-- }}} -->
			<div id='File'> <!-- {{{ -->
				[!(
				// args = obj, buttontext, cb
				elements[0].id = make_id(printer, args[0]),
				elements[1].source = args[0],
				elements[1].printer = printer,
				elements[1].AddText(args[1]),
				elements[1].extra = (args[2] ? args[2] : function() {}),
				stack
				<input type='file'/>
				<button class='button' type='button' onclick='set_file(this.printer, this.source); this.extra()'></button>
				)!]
			</div> <!-- }}} -->
			<div id='Run'> <!-- {{{ -->
				[!(
				// args = obj, class
				args[0][1] === null ? '' : (
				elements[0].id = make_id(printer, args[0], 'minus'),
				elements[2].id = make_id(printer, args[0], 'plus'),
				elements[4].id = make_id(printer, args[0], 'value'),
				elements[1].htmlFor = elements[0].id,
				elements[3].htmlFor = elements[2].id,
				elements[0].printer = printer,
				elements[2].printer = printer,
				elements[0].obj = args[0],
				elements[2].obj = args[0],
				elements[0].factor = -1,
				elements[2].factor = 1,
				elements[0].other = elements[2],
				elements[2].other = elements[0],
				elements[0].addEventListener('click', function() { this.other.checked = false; this.printer.call('run_' + this.obj[0][0], [this.obj[1], this.checked ? this.factor * Number(get_element(this.printer, this.obj, 'value').value / 1000.) : NaN], {}); }, false),
				elements[2].addEventListener('click', function() { this.other.checked = false; this.printer.call('run_' + this.obj[0][0], [this.obj[1], this.checked ? this.factor * Number(get_element(this.printer, this.obj, 'value').value / 1000.) : NaN], {}); }, false),
				args[1] ? elements[0].AddClass(args[1]) : 0,
				args[1] ? elements[1].AddClass(args[1]) : 0,
				args[1] ? elements[2].AddClass(args[1]) : 0,
				args[1] ? elements[3].AddClass(args[1]) : 0,
				args[1] ? elements[4].AddClass(args[1]) : 0,
				elements)
				<input type='checkbox' class='run1'/>
				<label class='run2'>-</label>
				<input type='checkbox' class='run1'/>
				<label class='run2'>+</label>
				<input type='text' class='run3' value='Infinity'/>
				)!]
			</div> <!-- }}} -->
			<!-- }}} -->
			<div id='Motor'> <!-- {{{ -->
				<!-- args = parent, index, basic_steps -->
				<div>[$(Float [[[[args[0], 'motor'], args[1]], 'max_steps'], 1])$]</div>
				<div>[$(Float [[[[args[0], 'motor'], args[1]], 'limit_v'], .001])$]</div>
				<div>[$(Float [[[[args[0], 'motor'], args[1]], 'limit_a'], 1])$]</div>
				<!--sleeping.-->
			</div> <!-- }}} -->
			<div id='Temp_components'> <!-- {{{ -->
				<!-- args = parent, index -->
				<div>[$(Float [[[args[0], args[1]], 'R0'], 1000])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'R1'], 1000])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'Rc'], 1000])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'Tc'], 1])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'beta'], 1])$]</div>
			</div> <!-- }}} -->
			<div id='Temp_calibration'> <!-- {{{ -->
				<!-- args = parent, index -->
				<div>[$(Float [[[args[0], args[1]], 'core_C'], 1])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'shell_C'], 1])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'transfer'], 1])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'radiation'], 1])$]</div>
				<div>[$(Float [[[args[0], args[1]], 'power'], 1])$]</div>
			</div> <!-- }}} -->
			<div id='Temp_control'> <!-- {{{ -->
				<div>[$(Float [[[args[0], args[1]], 'value', 'settemp']])$]</div>
				<div>[!(
					// args = obj, index
					//elements[1].id = make_id(printer, [[args[0], args[1]], 'current']),
					elements[0].target = elements[1],
					elements[0].printer = printer,
					elements[0].addEventListener('click', function() {
						var target = this.target;
						this.printer.call('readtemp_' + (typeof args[0] == 'string' ? args[0] : args[0][0]), [args[1]], {}, function(value) {
							target.ClearAll();
							target.AddText(value.toFixed(1));
						});
					}, false),
					elements
					<button>Refresh</button>
					<span></span>
				)!]</div>
				<!-- current -->
			</div> <!-- }}} -->

			<div id='Motor_axis'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow(axis_name(args[0], false), elements, ['rowtitle3', args[1]])]
				[$(Motor ['axis', args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Axis_axis'> <!-- {{{ -->
				[!(
				// args = index; park should not be in this table.
				[make_tablerow(axis_name(args[0], false), elements, ['rowtitle4'])]
				<div>[$(Float [[[['axis', 'motor'], args[0]], 'steps_per_m'], 1000])$]</div>
				<div>[$(Float [[['axis', args[0]], 'limit_pos'], .001])$]</div>
				<div>[$(Float [[['axis', args[0]], 'motor_min'], .001])$]</div>
				<div>[$(Float [[['axis', args[0]], 'motor_max'], .001])$]</div>
				<div>[$(Run [[['axis', 'motor'], args[0]]])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Park_axis'> <!-- {{{ -->
				[!(
				// args = index; park should not be in this table.
				[make_tablerow(axis_name(args[0], true), elements, ['rowtitle1'])]
				<div>[$(Float [[['axis', args[0]], 'park'], .001])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Delta_axis'> <!-- {{{ -->
				[!(
				// args = index
				[make_tablerow(axis_name(args[0], false), elements, ['rowtitle4'])]
				<div>[$(Float [[['axis', args[0]], 'delta_length'], .001])$]</div>
				<div>[$(Float [[['axis', args[0]], 'delta_radius'], .001])$]</div>
				<div>[$(Float [[['axis', args[0]], 'axis_min'], .001])$]</div>
				<div>[$(Float [[['axis', args[0]], 'axis_max'], .001])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Move_axis'> <!-- {{{ -->
				[!(
				// args = index
				elements[1].id = make_id(printer, [['axis', args[0]], 'goto']),
				elements[2].printer = printer,
				elements[2].index = args[0],
				elements[2].addEventListener('click', function() {
					var target = new Object;
					target[String(args[0])] = Number(get_element(this.printer, [['axis', this.index], 'goto']).value) / 1000.;
					this.printer.call('goto', [target], {});
				}, false),
				[make_tablerow(axis_name(args[0], true), [[elements[1], elements[2]], elements[0]], ['rowtitle3', ''])]
				<div>[$(Float [[['axis', args[0]], 'offset'], .001])$]</div>
				<input type='text'/>
				<button class='button' type='button'>Go</button>
				)!]
			</div> <!-- }}} -->
			<div id='Pins_axis'> <!-- {{{ -->
				[!(
				make_pin_title(axis_name(args[0], false), stack)
				[$(Pin ['Step', [[['axis', 'motor'], args[0]], 'step_pin']])$]
				[$(Pin ['Dir', [[['axis', 'motor'], args[0]], 'dir_pin']])$]
				[$(Pin ['Enable', [[['axis', 'motor'], args[0]], 'enable_pin']])$]
				[$(Pin ['Min limit', [['axis', args[0]], 'limit_min_pin']])$]
				[$(Pin ['Max limit', [['axis', args[0]], 'limit_max_pin']])$]
				[$(Pin ['Sense', [['axis', args[0]], 'sense_pin']])$]
				)!]
			</div> <!-- }}} -->
			<div id='Motor_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow(extruder_name(args[0]), elements, ['rowtitle3', args[1]])]
				[$(Motor ['extruder', args[0], true])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_components_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow(extruder_name(args[0]), elements, ['rowtitle5', args[1]])]
				[$(Temp_components [['extruder', 'temp'], args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_calibration_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow(extruder_name(args[0]), elements, ['rowtitle5', args[1]])]
				[$(Temp_calibration [['extruder', 'temp'], args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_control_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow(extruder_name(args[0]), elements, ['rowtitle2', args[1]])]
				[$(Temp_control [['extruder', 'temp'], args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Maxv_axis'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow(axis_name(args[0], true), elements, ['rowtitle1'])]
				<div>[$(Float [[[['axis', 'motor'], args[0]], 'max_v'], .001])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Maxv_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow(extruder_name(args[0]), elements, ['rowtitle1'])]
				<div>[$(Float [[[['extruder', 'motor'], args[0]], 'max_v'], .001])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Move_extruder'> <!-- {{{ -->
				[!(
				// args = index, class
				elements[0].id = make_id(printer, [['extruder', args[0]], 'move']),
				elements[1].printer = printer,
				elements[1].index = args[0],
				elements[1].addEventListener('click', function() {
					var value = Number(get_element(this.printer, [['extruder', this.index], 'move']).value);
					this.printer.call('goto', [], {e: value / 1000., which: this.index});
				}, false),
				elements[2].printer = printer,
				elements[2].index = args[0],
				elements[2].addEventListener('click', function() {
					var value = Number(get_element(this.printer, [['extruder', this.index], 'move']).value);
					this.printer.call('goto', [], {e: -value / 1000., which: this.index});
				}, false),
				[make_tablerow(extruder_name(args[0]), [elements[3], [elements[0], elements[1], elements[2]], elements[4]], ['rowtitle3', args[1]])]
				<input type='text'/>
				<button class='button' type='button'>Extrude</button>
				<button class='button' type='button'>Retract</button>
				<div>[$(Float [[[['extruder', 'motor'], args[0]], 'steps_per_m'], 1000])$]</div>
				<div>[$(Run [[['extruder', 'motor'], args[0]]])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Pins_extruder'> <!-- {{{ -->
				[!(
				// args = index, visible
				node.id = make_id(printer, [['extruderpins', args[0]], 'container']),
				make_pin_title(extruder_name(args[0]), stack)
				[$(Pin ['Step', [[['extruder', 'motor'], args[0]], 'step_pin']])$]
				[$(Pin ['Direction', [[['extruder', 'motor'], args[0]], 'dir_pin']])$]
				[$(Pin ['Enable', [[['extruder', 'motor'], args[0]], 'enable_pin']])$]
				[$(Pin ['Power', [[['extruder', 'temp'], args[0]], 'power_pin']])$]
				[$(Pin ['Thermistor', [[['extruder', 'temp'], args[0]], 'thermistor_pin'], true])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_components_temp'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow(temp_name(args[0]), elements, ['rowtitle5', args[1]])]
				[$(Temp_components ['temp', args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_calibration_temp'> <!-- {{{ -->
				[!(
				// args = index, class
				[make_tablerow(temp_name(args[0]), elements, ['rowtitle5', args[1]])]
				[$(Temp_calibration ['temp', args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Temp_control_temp'> <!-- {{{ -->
				[!(
				// args = index
				[make_tablerow(temp_name(args[0]), elements, ['rowtitle2', args[1]])]
				[$(Temp_control ['temp', args[0]])$]
				)!]
			</div> <!-- }}} -->
			<div id='Pins_temp'> <!-- {{{ -->
				[!(
				// args = index, visible
				node.id = make_id(printer, [['temppins', args[0]], 'container']),
				make_pin_title(temp_name(args[0]), stack)
				[$(Pin ['Power', [['temp', args[0]], 'power_pin']])$]
				[$(Pin ['Thermistor', [['temp', args[0]], 'thermistor_pin'], true])$]
				)!]
			</div> <!-- }}} -->
			<div id='Gpio_gpio'> <!-- {{{ -->
				[!(
				// args = index, visible
				elements[0].id = make_id(printer, [['gpio', args[0]], 'master']),
				elements[1].index = args[0],
				elements[1].printer = printer,
				[make_tablerow(gpio_name(args[0]), [[elements[0], elements[1]], elements[2]], ['rowtitle2', args[1]], undefined, [['gpio', args[0]], 'settings'])]
				<select>[!(temprange(elements[0], 'value')<option></option>)!]</select>
				<button class='button' type='button' onclick='set_gpio_master(this.printer, this.index)'>Set</button>
				<div>[$(Float [[['gpio', args[0]], 'value'], 1])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='State_gpio'> <!-- {{{ -->
				[!(
				// args = index, visible
				elements[1].id = make_id(printer, ['gpio', 'value']),
				[make_tablerow(gpio_name(args[0]), elements, ['rowtitle2', args[1]], undefined, [['gpio', args[0]], 'state'])]
				<div>[$(Choice [[['gpio', args[0]], 'state'], ['Off', 'On', 'Input', 'High&nbsp;Z']])$]</div>
				<span></span>
				)!]
			</div> <!-- }}} -->
			<div id='Pins_gpio'> <!-- {{{ -->
				[!(
				// args = index, visible
				node.id = make_id(printer, [['gpiopins', args[0]], 'container']),
				make_pin_title(gpio_name(args[0]), stack)
				[$(Pin ['Pin', [['gpio', args[0]], 'pin']])$]
				)!]
			</div> <!-- }}} -->

			<div id='Printer'> <!-- {{{ -->
				<div class='printer'>
					[!(
						// TODO: upload script, see printing state.
						node.id = make_id(printer, [null, 'container']),
						elements[0].id = make_id(printer, [null, 'block1']),
						elements
						<div class='hidden blocker'></div>
					)!]
					<div class='setup'> <!-- {{{ -->
						<!-- Global settings {{{ -->
						<div>
							Printer type:
							[!(
								elements[0].printer = printer,
								elements[0].obj = create_printer_type_select(),
								elements[0].onclick = function() {
									set_value(this.printer, [null, 'printer_type'], this.obj.selectedIndex);
								},
								elements[1].id = make_id(printer, [null, 'printer_type']),
								[elements[0].obj, elements[0], elements[1]]
								<button type='button'>Set</button>
								<span></span>
							)!]
						</div>
						<div>[$(Text ['Name', [null, 'name']])$]</div>
						<div>Motor Timeout: [$(Float [[null, 'motor_limit'], 60])$] min</div>
						<div>Temp Timeout: [$(Float [[null, 'temp_limit'], 60])$] min</div>
						<div>Max Deviation: [$(Float [[null, 'max_deviation'], .001])$] μm</div>
						<div>Spaces: [$(Float [[null, 'num_spaces'], 1])$]</div>
						<div>Temps: [$(Float [[null, 'num_temps'], 1])$]</div>
						<div>Gpios: [$(Float [[null, 'num_gpios'], 1])$]</div>
						<!-- }}} -->

						[!([make_table( // Motor {{{
							multiple_titles(['extruder', 'axis'], [
								'Motors',
								'Microsteps',
								'Max v (mm/s)',
								'Max a (m/s²)'
							], [
								'htitle3',
								'title3',
								'title3',
								'title3'
							], [
								null,
								'Maximum number of steps to do in one iteration; set to number of microsteps.',
								'Maximum speed that the motor is allowed to move.',
								'Maximum acceleration that the motor is allowed to do.'
							]),
							multiple('Motor_axis'),
							multiple('Motor_extruder')
						)])!] <!-- }}} -->

						[!([make_table( // Axis uvw {{{
							multiple_titles(['axis'], [
								'Axis',
								'Coupling (steps/mm)',
								'Switch pos (mm)',
								'Motor min (mm)',
								'Motor max (mm)',
								'Run'
							], [
								'htitle5',
								'title5',
								'title5',
								'title5',
								'title5',
								'title5'
							], [
								null,
								'Number of (micro)steps that the motor needs to do to move the hardware by one mm.',
								'Position of the limit switch.',
								'Minimum value that the motor may move to.',
								'Maximum value that the motor may move to.',
								'Move motor indefinitely.'
							]),
							multiple('Axis_axis')
						)])!] <!-- }}} -->

						[!([make_table( // Axis xyz {{{
							multiple_titles(['axis'], [
								'Axis',
								'Park pos (mm)'
							], [
								'htitle1',
								'title1',
							], [
								null,
								'Park position of the axis.'
							]),
							multiple('Park_axis')
						)])!] <!-- }}} -->

						[!([make_table( // Axis delta {{{
							multiple_titles(['axis'], [
								'Delta',
								'Rod length (mm)',
								'Radius (mm)',
								'Axis min (mm)',
								'Axis max (mm)'
							], [
								'htitle4',
								'title4',
								'title4',
								'title4',
								'title4'
							], [
								null,
								'Minimum distance from tower. (Normally 0.)',
								'Maximum distance from tower. (Normally equal to tie rod length.)',
								'Length of the tie rods, measured between the pivot points.',
								'Horizontal distance between the pivot points of the tie rods.  Note that this value does not include the effector or carriage offsets.'
							]),
							multiple('Delta_axis')
						).AddClass('delta')])!] <!-- }}} -->

						[!([make_table( // Temp {{{
							multiple_titles(['extruder', 'temp'], [
								'Temps',
								'R0 (kΩ)',
								'R1 (kΩ)',
								'Rc (kΩ)',
								'Tc (°C)',
								'β (1)'
							], [
								'htitle5',
								'title5',
								'title5',
								'title5',
								'title5',
								'title5'
							], [
								null,
								'Resistance on the board in series with the thermistor.  Normally 4.7 or 10.',
								'Resistance on the board in parallel with the thermistor.  Normally Infinity.',
								'Calibrated resistance of the thermistor.  Normally 100 for extruders, 10 for the heated bed.',
								'Temperature at which the thermistor has value Rc.  Normally 20.',
								"Temperature dependence of the thermistor.  Normally around 3800.  It can be found in the thermistor's data sheet."
							]),
							multiple('Temp_components_extruder'),
							multiple('Temp_components_temp')
						)])!] <!-- }}} -->

						[!([make_table( // Gpio {{{
							multiple_titles(['gpio'], [
								'Gpio',
								'Master temp',
								'Threshold(°C)'
							], [
								'htitle2',
								'title2',
								'title2'
							], [
								null,
								'If set to something other than None, the pin will automatically be set and reset depending on the value of the selected temperature control.',
								'If a master temp is set, the pin will be on if that temp is above this value, otherwise it will be off.'
							]),
							multiple('Gpio_gpio')
						)])!] <!-- }}} -->

						[!([make_table(elements[0], elements[1], // Pins {{{
							multiple('Pins_axis', null, false),
							multiple('Pins_extruder', null, false),
							multiple('Pins_temp', null, false),
							multiple('Pins_gpio', null, false))]
							[$(Pin ['LED', [null, 'led_pin']])$]
							[$(Pin ['Probe', [null, 'probe_pin']])$]
							)!] <!-- }}} -->

						<div>[!(elements[0].port = port, elements<button type='button' onclick="rpc.call('disable', [this.port], {})">Disable printer</button>)!]</div>
				</div> <!-- }}} -->
					<div class='queuediv'> <!-- {{{ Queue. -->
						<div>
							[!(
								elements[0].id = make_id(printer, [null, 'queue']),
								elements
								<select multiple='multiple'></select>
								<div class='queuelist'>
									<button type='button' class='queue1' onclick='queue_up()'>&#x2b06;</button>
									<span class='queue2'>[$(File [[null, 'queue_add', 'queue_add'], 'Add', queue_deselect])$]</span><br/>
									<button type='button' class='queue1' onclick='queue_del()'>×</button>
									<span class='queue2'>
										<button type='button' class='queue1' onclick='quick_print()'>Print selected</button>
										[!(
											elements[0].id = make_id(printer, [null, 'probebox']),
											elements[1].htmlFor = elements[0].id,
											elements
											<input type='checkbox'/>
											<label>Probe</label>
										)!]
									</span><br/>
									<button type='button' class='queue1' onclick='queue_down()'>&#x2b07;</button>
									<span class='queue2'>
										<button type='button' onclick="selected_printer.call('park', [], {}, update_canvas_and_spans)">Park</button>
										<button type='button' onclick="selected_printer.call('home', [], {}, update_canvas_and_spans)">Home</button>
										<button type='button' onclick="selected_printer.call('sleep_all', [], {}, update_canvas_and_spans)">Sleep</button>
									</span><br/>
									<span class='queue1'>
										[!(
											elements[0].id = make_id(printer, [null, 'status']),
											elements
											<span>Idle</span>
										)!]
									</span>
									<span class='queue2'>
										<button type='button' onclick="selected_printer.call('pause', [true], {})">Stop</button>
										<button type='button' onclick="selected_printer.call('pause', [false], {})">Resume</button>
									</span>
								</div>
							)!]
						</div>
					</div> <!-- }}} -->
					[!([make_table( // Axis xyz {{{
						multiple_titles(['axis'], [
							'Axis',
							'Go (mm)',
							'Offset (mm)'
						], [
							'htitle2',
							'title2',
							'title2'
						], [
							null,
							'Physically move the extruder to this position.  For Z, more positive numbers move the extruder away from the bed.',
							'Displacement of origin.  When instructed to go to a position, it will add this value to the position before going there.'
						]),
						multiple('Move_axis')
					)])!] <!-- }}} -->
					[!([make_table( // Extruder {{{
						multiple_titles(['extruder'], [
							'Extruder',
							'Coupling (steps/mm)',
							'Extrude (mm)',
							'Run'
						], [
							'htitle3',
							'title3',
							'title3',
							'title3'
						], [
							null,
							'Number of (micro)steps that the motor needs to do to move the filament by one mm.',
							'Extrude or retract this amount.',
							'Maximum speed that the axis will try to move along this coordinate.',
							'Move motor indefinitely.'
						]),
						multiple('Move_extruder')
					)])!] <!-- }}} -->
					<div class='movediv' onclick='start_move()' onkeydown='if (!key_move(event.keyCode, event.shiftKey, event.ctrlKey)) event.preventDefault()'><!-- {{{ -->
						[!(
							elements[0].id = make_id(printer, [null, 'movebox']),
							elements
							<div class='movebox'>
								<p>Amount per keypress: <input value='10' class='title' type='text' id='move_amount'/></p>
								<div class='move_viewbox'>
									[!(
										elements[0].id = make_id(printer, [null, 'move_view']),
										elements
										<canvas id='move_view'></canvas>
									)!]
								</div>
								<p>[!(
									elements[0].id = make_id(printer, [null, 'movespan0']),
									elements[1].id = make_id(printer, [null, 'movespan1']),
									elements[2].id = make_id(printer, [null, 'movespan2']),
									[elements[0], ', ', elements[1], ', ', elements[2], ' mm']
									<span></span>
									<span></span>
									<span></span>
								)!]</p>
								<p>
									<!-- TODO: document position.  -->
									<button type='button' onclick="reset_position()">Reset position</button>
								</p>
							</div>
						)!]
					</div><!-- }}} -->

					[!([make_table(	// Temp control {{{
						multiple_titles(['extruder', 'temp'], [
							'Temp control',
							'Target (°C)',
							'Current (°C)'
						], [
							'htitle4',
							'title4',
							'title4'
						], [
							null,
							'Temperature target.  Set to NaN to disable the heater completely.',
							'Request actual temperature from sensor.'
						]),
						multiple('Temp_control_extruder'),
						multiple('Temp_control_temp')
					).AddClass('left')])!] <!-- }}} -->
					[!([make_table( // Gpio {{{
						multiple_titles(['gpio'], [
							'Gpio',
							'State',
							'Value'
						], [
							'htitle4',
							'title3',
							'title6'
						], [
							null,
							'State of the pin.',
							'Value of the pin.'
						]),
						multiple('State_gpio')
					).AddClass('left')])!] <!-- }}} -->

					<div>Feedrate: [$(Float [[null, 'feedrate'], .01])$] %</div>

					[!([make_table( // Max v {{{
						multiple_titles(['axis', 'extruder'], [
							'',
							'Max v (mm/s)'
						], [
							'htitle2',
							'title2'
						], [
							null,
							'Maximum speed that the axis will try to move along this coordinate.'
						]),
						multiple('Maxv_axis'),
						multiple('Maxv_extruder')
					).AddClass('left')])!] <!-- }}} -->

					[!(
						elements[0].id = make_id(printer, [null, 'scripts']),
						elements
						<div></div>
					)!]

					<!-- Save and restore {{{ -->
					[$(Button ['Save settings to EEPROM', 'save_all'])$]
					[$(Button ['Restore settings from EEPROM', 'load_all'])$]
					<div>[$(File [[null, 'import', 'import_settings'], 'Import'])$]</div>
					<div>[!(
						elements[0].id = make_id(printer, [null, 'export']),
						stack
						<a class='title' title='Save settings to disk.'>Export settings to file</a>
					)!]</div>
					[!(
						elements[0].id = make_id(printer, [null, 'message1']),
						elements
						<div class='message'></div>
					)!]
					<!-- }}} -->
				</div>
			</div> <!-- }}} -->
			<div id='NoPrinter'> <!-- {{{ -->
				<div class='noprinter notconnected setup'>
					[!(
						node.id = make_id({'port': args[0]}, [null, 'nocontainer']),
						elements[0].id = make_id({'port': args[0]}, [null, 'block2']),
						elements
						<div class='hidden blocker'></div>
					)!]
					<h2>No printer is found on this port.</h2>
					<p>
						If autodetect does not work, you can request to detect a printer:
						[!(
							elements[0].port = args[0],
							elements
							<button type='button' onclick='rpc.call("detect", [this.port], {});'>Detect</button>
						)!]
					</p>
					<p>
						Or you can upload the firmware that fits your hardware.
						[!(upload_buttons(args[0], [['melzi', '1284p (Melzi, Sanguinololu)'], ['ramps', 'mega2560 (Ramps)'], ['mega', 'mega']]))!]
					</p>
					[!(
						elements[0].id = make_id({'port': args[0]}, [null, 'message2']),
						elements
						<div class='message'></div>
					)!]
				</div>
			</div> <!-- }}} -->
		</div> <!-- }}} -->
		<div id='labels'></div>
		<div id='printers'></div>
		<div id='debug'></div>
		<div id='scripts'></div>
	</body>
</html>
