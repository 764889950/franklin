<!DOCTYPE html>
<!-- vim: set foldmethod=marker : -->
<html>
	<head> <!-- {{{ -->
		<meta http-equiv='Content-type: text/html;charset=utf-8'/>
		<title>MOST RepRap printer interface</title>
		<script type='application/javascript' src='rpc.js'></script>
		<script type='application/javascript' src='server.js'></script>
		<script type='application/javascript' src='main.js'></script>
		<style type='text/css'></style>
		<link rel='stylesheet' href='main.css'/>
	</head> <!-- }}} -->
	<body onload='init()' id='container' class='nosetup'>
		<div id='templates'> <!-- {{{ -->
			<div id='Label'> <!-- {{{ -->
				<div class='tab' onclick='select_printer(this.port)'>
					[!(
						node.port = args[0],
						printer ? [printer.name].concat(elements) : elements
						<span class='port setup'>[!('@' + args[0])!]</span>
					)!]
				</div>
			</div> <!-- }}} -->
			<!-- Primitives {{{ -->
			<div id='Button'> <!-- {{{ -->
				[!(
				// args = title, action, class
				//elements[0].id = make_id(printer, [null, args[1]]),
				elements[0].action = args[1],
				args[2] ? elements[0].AddClass(args[2]) : 0,
				elements[0].printer = printer,
				elements[0].AddText(args[0]),
				elements
				<button class='wide title' type='button' onclick='this.printer.call(this.action, [], {})'></button>
				)!]
			</div> <!-- }}} -->
			<div id='Text'> <!-- {{{ -->
				[!(
				// args = title, obj, class
				elements[1].id = make_id(printer, args[1], 'source'),
				elements[2].source = elements[1].id,
				elements[2].obj = args[1],
				args[2] ? elements[0].AddClass(args[2]) : 0,
				args[2] ? elements[1].AddClass(args[2]) : 0,
				args[2] ? elements[2].AddClass(args[2]) : 0,
				elements[2].printer = printer,
				elements[0].AddText(args[0]),
				elements
				<span class='blocktitle'></span>
				<input type='text' class='title'/>
				<button class='button title' type='button' onclick='set_value(this.printer, this.obj, document.getElementById(this.source).value)'>Set</button>
				)!]
			</div> <!-- }}} -->
			<div id='Choice'> <!-- {{{ -->
				[!(
				// args = obj, options, class[es], containerclasses
				choice(args[0], args[1], elements[0], elements[1], args[2], args[3])
				<input type='radio'/>
				<label></label>
				)!]
			</div> <!-- }}} -->
			<div id='Pin'> <!-- {{{ -->
				[!(
				// args = title, obj, only_analog
				elements[0].id = make_id(printer, args[1]),
				elements[0].obj = args[1],
				elements[0].printer = printer,
				elements[1].id = make_id(printer, args[1], 'valid'),
				elements[2].htmlFor = elements[1].id,
				elements[3].id = make_id(printer, args[1], 'inverted'),
				elements[4].htmlFor = elements[3].id,
				elements[5].printer = printer,
				elements[5].addEventListener('click', function() { set_pin(this.printer, args[1]); }, false),
				args[2] ? (elements[3].AddClass('hidden'), elements[4].AddClass('hidden')) : 0,
				[make_tablerow(args[0], [[elements[0]], [elements[1], elements[2]], [elements[3], elements[4]], [elements[5]]], ['pintitle', 'pinvalue'])]
				<select class='pinselect'>[!(pinrange(args[2], elements[0], 'value')<option></option>)!]</select>
				<input type='checkbox'/>
				<label>Valid</label>
				<input type='checkbox'/>
				<label>Inverted</label>
				<button class='button' type='button'>Set</button>
				)!]
			</div> <!-- }}} -->
			<div id='Float'> <!-- {{{ -->
				[!(
				// args = obj, factor, class
				elements[2].id = make_id(printer, args[0]),
				elements[0].id = make_id(printer, args[0], 'new'),
				elements[0].factor = args[1] ? args[1] : 1,
				elements[1].factor = elements[0].factor,
				elements[2].factor = elements[0].factor,
				elements[1].source = elements[0].id,
				elements[0].obj = args[0],
				elements[1].obj = args[0],
				elements[0].printer = printer,
				elements[1].printer = printer,
				args[2] ? elements[0].AddClass(args[2]) : 0,
				args[2] ? elements[1].AddClass(args[2]) : 0,
				args[2] ? elements[2].AddClass(args[2]) : 0,
				stack
				<input type='text' onkeydown='floatkey(event, this)'/>
				<button class='button' type='button' onclick='set_value(this.printer, this.obj, this.factor * Number(document.getElementById(this.source).value))'>Set</button>
				<span></span>
				)!]
			</div> <!-- }}} -->
			<div id='Toggle'> <!-- {{{ -->
				[!(
				// args = title, obj, oncommand, offcommand, ontext, offtext, class
				elements[1].AddText(args[2]),
				elements[2].AddText(args[3]),
				elements[3].value = [args[5], args[4]],
				elements[3].id = make_id(printer, args[1]),
				elements[1].obj = args[1],
				elements[2].obj = args[1],
				elements[1].printer = printer,
				elements[2].printer = printer,
				elements[1].addEventListener('click', function() { set_value(this.printer, this.obj, true); }, false),
				elements[2].addEventListener('click', function() { set_value(this.printer, this.obj, false); }, false),
				elements[0].AddText(args[0]),
				args[6] ? elements[0].AddClass(args[6]) : 0,
				args[6] ? elements[1].AddClass(args[6]) : 0,
				args[6] ? elements[2].AddClass(args[6]) : 0,
				args[6] ? elements[3].AddClass(args[6]) : 0,
				stack
				<span class='blocktitle'></span>
				<button type='button' class='title'></button>
				<button type='button' class='title'></button>
				<span class='title'></span>
				)!]
			</div> <!-- }}} -->
			<div id='File'> <!-- {{{ -->
				[!(
				// args = obj, buttontext, cb
				elements[0].id = make_id(printer, args[0]),
				elements[1].source = args[0],
				elements[1].printer = printer,
				elements[1].AddText(args[1]),
				elements[1].extra = (args[2] ? args[2] : null),
				stack
				<input type='file'/>
				<button class='button' type='button' onclick='set_file(this.printer, this.source); if (this.extra !== null) this.extra()'></button>
				)!]
			</div> <!-- }}} -->
			<!-- }}} -->

			<div id='Spacetype_space'> <!-- {{{ -->
				[!(
					elements[0].printer = printer,
					elements[0].index = args[1],
					elements[0].obj = create_space_type_select(),
					elements[1].id = make_id(printer, [['space', args[1]], 'type']),
					[make_tablerow(space_name(args[1]), [[elements[0].obj, elements[0], elements[1]], elements[2]], ['rowtitle1'])]
					<button type='button' onclick="set_value(this.printer, [['space', this.index], 'type'], this.obj.selectedIndex)">Set</button>
					<span></span>
					<div>Max Deviation: [$(Float [[['space', args[1]], 'max_deviation'], .000001])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Extruder_space'> <!-- {{{ -->
				[!(
					[make_tablerow(space_name(args[1]), elements, ['rowtitle3'], undefined, TYPE_EXTRUDER, args[1])]
					<div>[$(Float [[['space', args[1]], 'dx'], 1])$]</div>
					<div>[$(Float [[['space', args[1]], 'dy'], 1])$]</div>
					<div>[$(Float [[['space', args[1]], 'dz'], 1])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Cartesian_space'> <!-- {{{ -->
				[!(
					[make_tablerow(space_name(args[1]), elements, ['rowtitle1'], undefined, TYPE_CARTESIAN, args[1])]
					<div>[$(Float [[['space', args[1]], 'num_axes'], 1])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Delta_motor'> <!-- {{{ -->
				[!(
					[make_tablerow(motor_name(args[1], args[2]), elements, ['rowtitle4'], undefined, TYPE_DELTA, args[1])]
					<div>[$(Float [[['motor', [args[1], args[2]]], 'delta_axis_min'], 0.001])$]</div>
					<div>[$(Float [[['motor', [args[1], args[2]]], 'delta_axis_max'], 0.001])$]</div>
					<div>[$(Float [[['motor', [args[1], args[2]]], 'delta_rodlength'], 0.001])$]</div>
					<div>[$(Float [[['motor', [args[1], args[2]]], 'delta_radius'], 0.001])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Delta_space'> [!( args[0].AddMultiple('motor', 'Delta_motor', true, args[1]), '')!] </div>
			<div id='Deltaangle_space'> <!-- {{{ -->
				[!(
					[make_tablerow(space_name(args[1]), elements, ['rowtitle1'], undefined, TYPE_DELTA, args[1])]
					<div>[$(Float [[['space', args[1]], 'delta_angle'], Math.PI / 180])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Axis_axis'> <!-- {{{ -->
				[!(
					[make_tablerow(axis_name(args[1], args[2]), elements, ['rowtitle2'])]
					<div>[$(Float [[['axis', [args[1], args[2]]], 'park'], 0.001])$]</div>
					<div>[$(Float [[['axis', [args[1], args[2]]], 'park_order'], 1])$]</div>
					<div>[$(Float [[['axis', [args[1], args[2]]], 'max_v'], 0.001])$]</div>
					<div>[$(Float [[['axis', [args[1], args[2]]], 'min'], 0.001])$]</div>
					<div>[$(Float [[['axis', [args[1], args[2]]], 'max'], 0.001])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Axis_space'> [!( args[0].AddMultiple('axis', 'Axis_axis', true, args[1]), '')!] </div>
			<div id='Motor1_motor'> <!-- {{{ -->
				[!(
					[make_tablerow(motor_name(args[1], args[2]), elements, ['rowtitle3'])]
					<div>[$(Float [[['motor', [args[1], args[2]]], 'max_steps'], 1])$]</div>
					<div>[$(Float [[['motor', [args[1], args[2]]], 'home_pos'], 0.001])$]</div>
					<div>[$(Float [[['motor', [args[1], args[2]]], 'home_order'], 1])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Motor1_space'> [!( args[0].AddMultiple('motor', 'Motor1_motor', true, args[1]), '')!] </div>
			<div id='Motor2_motor'> <!-- {{{ -->
				[!(
					[make_tablerow(motor_name(args[1], args[2]), elements, ['rowtitle4'])]
					<div>[$(Float [[['motor', [args[1], args[2]]], 'motor_min'], 0.001])$]</div>
					<div>[$(Float [[['motor', [args[1], args[2]]], 'motor_max'], 0.001])$]</div>
					<div>[$(Float [[['motor', [args[1], args[2]]], 'limit_v'], 0.001])$]</div>
					<div>[$(Float [[['motor', [args[1], args[2]]], 'limit_a'], 1])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Motor2_space'> [!( args[0].AddMultiple('motor', 'Motor2_motor', true, args[1]), '')!] </div>
			<div id='Steps_motor'> <!-- {{{ -->
				[!(
					[make_tablerow(motor_name(args[1], args[2]), elements, ['rowtitle2'])]
					<div>[$(Float [[['motor', [args[1], args[2]]], 'steps_per_m'], 1000])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Steps_space'> [!( args[0].AddMultiple('motor', 'Steps_motor', true, args[1]), '')!] </div>
			<div id='Move_axis'> <!-- {{{ -->
				[!(
				elements[1].id = make_id(printer, [['axis', [args[1], args[2]]], 'goto']),
				elements[2].printer = printer,
				elements[2].index = [args[1], args[2]],
				elements[2].addEventListener('click', function() {
					var target = new Object;
					target[String(args[2])] = Number(get_element(this.printer, [['axis', this.index], 'goto']).value) / 1000.;
					var fulltarget = new Object;
					fulltarget[String(args[1])] = target;
					this.printer.call('goto', [fulltarget], {cb: true});
					this.printer.call('wait_for_cb', [], {}, update_canvas_and_spans);
				}, false),
				[make_tablerow(axis_name(args[1], args[2]), [[elements[1], elements[2]], elements[0]], ['rowtitle3', ''])]
				<div>[$(Float [[['axis', [args[1], args[2]]], 'offset'], 0.001])$]</div>
				<input type='text'/>
				<button class='button' type='button'>Go</button>
				)!]
			</div> <!-- }}} -->
			<div id='Move_space'> [!( args[0].AddMultiple('axis', 'Move_axis', false, args[1]), '')!] </div>
			<div id='Pins_motor'> <!-- {{{ -->
				[!(
				make_pin_title(motor_name(args[1], args[2]), elements)
				[$(Pin ['Step', [['motor', [args[1], args[2]]], 'step_pin']])$]
				[$(Pin ['Dir', [['motor', [args[1], args[2]]], 'dir_pin']])$]
				[$(Pin ['Enable', [['motor', [args[1], args[2]]], 'enable_pin']])$]
				[$(Pin ['Min limit', [['motor', [args[1], args[2]]], 'limit_min_pin']])$]
				[$(Pin ['Max limit', [['motor', [args[1], args[2]]], 'limit_max_pin']])$]
				[$(Pin ['Sense', [['motor', [args[1], args[2]]], 'sense_pin']])$]
				)!]
			</div> <!-- }}} -->
			<div id='Pins_space'> [!( args[0].AddMultiple('motor', 'Pins_motor', false, args[1]), '')!] </div>

			<div id='Temp_temp'> <!-- {{{ -->
				[!(
					[make_tablerow(temp_name(args[1]), elements, ['rowtitle5'])]
					<div>[$(Float [[['temp', args[1]], 'R0'], 1000])$]</div>
					<div>[$(Float [[['temp', args[1]], 'R1'], 1000])$]</div>
					<div>[$(Float [[['temp', args[1]], 'Rc'], 1000])$]</div>
					<div>[$(Float [[['temp', args[1]], 'Tc'], 1])$]</div>
					<div>[$(Float [[['temp', args[1]], 'beta'], 1])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Tempcontrol_temp'> <!-- {{{ -->
				[!(
					[make_tablerow(temp_name(args[1]), elements, ['rowtitle2'])]
					<div>[$(Float [[['temp', args[1]], 'value', 'settemp']])$]</div>
					<div>[!(
						args[1] !== null ? temptargets.push(elements[1]) : 0,
						elements[0].num = args[1],
						elements[0].target = elements[1],
						elements[0].printer = printer,
						elements[0].addEventListener('click', function() { update_temps(this.printer, this.num); }, false),
						elements
						<button>Refresh</button>
						<span></span>
					)!]</div>
				)!]
			</div> <!-- }}} -->
			<div id='Pins_temp'> <!-- {{{ -->
				[!(
				node.id = make_id(printer, [['temppins', args[1]], 'container']),
				make_pin_title(temp_name(args[1]), stack)
				[$(Pin ['Power', [['temp', args[1]], 'power_pin']])$]
				[$(Pin ['Thermistor', [['temp', args[1]], 'thermistor_pin'], true])$]
				)!]
			</div> <!-- }}} -->

			<div id='Gpio_gpio'> <!-- {{{ -->
				[!(
				elements[0].id = make_id(printer, [['gpio', args[1]], 'master']),
				elements[1].index = args[1],
				elements[1].printer = printer,
				[make_tablerow(gpio_name(args[1]), [[elements[0], elements[1]], elements[2]], ['rowtitle2'], [['gpio', args[1]], 'settings'])]
				<select>[!(temprange(elements[0], 'value')<option></option>)!]</select>
				<button class='button' type='button' onclick='set_gpio_master(this.printer, this.index)'>Set</button>
				<div>[$(Float [[['gpio', args[1]], 'value'], 1])$]</div>
				)!]
			</div> <!-- }}} -->
			<div id='State_gpio'> <!-- {{{ -->
				[!(
				elements[1].id = make_id(printer, ['gpio', 'value']),
				[make_tablerow(gpio_name(args[1]), elements, ['rowtitle2'], [['gpio', args[1]], 'state'])]
				<div>[$(Choice [[['gpio', args[1]], 'state'], ['Off', 'On', 'Input', 'High&nbsp;Z']])$]</div>
				<span></span>
				)!]
			</div> <!-- }}} -->
			<div id='Pins_gpio'> <!-- {{{ -->
				[!(
				node.id = make_id(printer, [['gpiopins', args[1]], 'container']),
				make_pin_title(gpio_name(args[1]), stack)
				[$(Pin ['Pin', [['gpio', args[1]], 'pin']])$]
				)!]
			</div> <!-- }}} -->

			<div id='Printer'> <!-- {{{ -->
				<div class='printer'>
					[!(
						// TODO: upload script, see printing state.
						node.id = make_id(printer, [null, 'container']),
						elements[0].id = make_id(printer, [null, 'block1']),
						elements
						<div class='hidden blocker'></div>
					)!]
					<div class='setup'> <!-- {{{ -->
						<!-- Global settings {{{ -->
						<div>[$(Text ['Name', [null, 'name']])$]</div>
						<div>Motor Timeout: [$(Float [[null, 'motor_limit'], 60])$] min</div>
						<div>Temp Timeout: [$(Float [[null, 'temp_limit'], 60])$] min</div>
						<div>Max probe distance: [$(Float [[null, 'probe_dist'], .001])$] mm</div>
						<div>Probe safe retract distance: [$(Float [[null, 'probe_safe_dist'], .001])$] mm</div>
						<div>Spaces: [$(Float [[null, 'num_spaces'], 1])$]</div>
						<div>Temps: [$(Float [[null, 'num_temps'], 1])$]</div>
						<div>Gpios: [$(Float [[null, 'num_gpios'], 1])$]</div>
						<!-- }}} -->

						<!-- Space settings {{{ -->
						[!([make_table().AddMultipleTitles([
						// Space {{{
								'Spaces',
								'Type',
								'Max Deviation (μm)'
							], [
								'htitle2',
								'title2',
								'title2'
							], [
								null,
								'Printer type',
								'Corners are rounded from requested path to this amount'
							]).AddMultiple('space', 'Spacetype_space')
						])!] <!-- }}} -->
						[!([make_table().AddMultipleTitles([
						// Extruder {{{
								'Extruder',
								'Offset X',
								'Offset Y',
								'Offset Z'
							], [
								'htitle3',
								'title3',
								'title3',
								'title3'
							], [
								null,
								'Offset in X direction when this extruder is in use.',
								'Offset in Y direction when this extruder is in use.',
								'Offset in Z direction when this extruder is in use.'
							]).AddMultiple('space', 'Extruder_space', false, 0)
						])!] <!-- }}} -->
						[!([make_table().AddMultipleTitles([
						// Cartesian {{{
								'Cartesian',
								'Number of axes'
							], [
								'htitle1',
								'title1'
							], [
								null,
								'Number of axes'
							]).AddMultiple('space', 'Cartesian_space', false, 0)
						])!] <!-- }}} -->
						[!([make_table().AddMultipleTitles([
						// Delta {{{
								'Delta',
								'Min Axis Distance',
								'Max Axis Distance',
								'Rod Length',
								'Radius'
							], [
								'htitle4',
								'title4',
								'title4',
								'title4',
								'title4'
							], [
								null,
								'Minimum distance of end effector from nozzle.  Usually 0. (mm)',
								'Maximum distance of end effector from nozzle.  Usually rod length. (mm)',
								'Length of the tie rods. (mm)',
								'Length of horizontal projection of the tie rod when the end effector is at (0, 0). (mm)'
							]).AddMultiple('space', 'Delta_space', false, 1)
						])!] <!-- }}} -->
						[!([make_table().AddMultipleTitles([
						// Delta angle {{{
								'Delta',
								'Angle'
							], [
								'htitle1',
								'title1'
							], [
								null,
								'Correction angle for the printer. (degrees)'
							]).AddMultiple('space', 'Deltaangle_space', false, 1)
						])!] <!-- }}} -->
						[!([make_table().AddMultipleTitles([
						// Axis {{{
								'Axes',
								'Park pos (mm)',
								'Park order',
								'Max v (mm/s)',
								'Min (mm)',
								'Max (mm)'
							], [
								'htitle5',
								'title5',
								'title5',
								'title5',
								'title5',
								'title5'
							], [
								null,
								'Park position of the nozzle.',
								'Order when parking.  Equal order parks simultaneously; lower order parks first.',
								'Maximum speed that the motor is allowed to move.',
								'Minimum position that the axis is allowed to go to.',
								'Maximum position that the axis is allowed to go to.'
							]).AddMultiple('space', 'Axis_space', false)
						])!] <!-- }}} -->
						[!([make_table().AddMultipleTitles([
						// Motor part 1 {{{
								'Motor',
								'Microsteps',
								'Switch pos (mm)',
								'Home order'
							], [
								'htitle3',
								'title3',
								'title3',
								'title3'
							], [
								null,
								'Maximum number of steps to do in one iteration.  Set to number of microsteps.',
								'Position of the home switch. (mm)',
								'Order when homing.  Equal order homes simultaneously; lower order homes first.'
							]).AddMultiple('space', 'Motor1_space', false)
						])!] <!-- }}} -->
						[!([make_table().AddMultipleTitles([
						// Motor part 1 {{{
								'Motor',
								'Motor min (mm)',
								'Motor max (mm)',
								'Limit v (mm/s)',
								'Limit a (mm/s²)'
							], [
								'htitle4',
								'title4',
								'title4',
								'title4',
								'title4'
							], [
								null,
								'Minimum value that the motor may move to. (mm)',
								'Maximum value that the motor may move to. (mm)',
								'Maximum speed of the motor. (mm/s)',
								'Maximum acceleration of the motor. (m/s²)'
							]).AddMultiple('space', 'Motor2_space', false)
						])!] <!-- }}} -->
						<!-- }}} -->

						[!([make_table().AddMultipleTitles([
						// Temp {{{
								'Temps',
								'R0 (kΩ) or a (1000)',
								'R1 (kΩ) or b (1000)',
								'Rc (kΩ)',
								'Tc (°C)',
								'β (1) or NaN'
							], [
								'htitle5',
								'title5',
								'title5',
								'title5',
								'title5',
								'title5'
							], [
								null,
								'Resistance on the board in series with the thermistor.  Normally 4.7 or 10.  Or, if β is NaN, the result is ax+b with x the measured ADC value; this value is a/1000.',
								'Resistance on the board in parallel with the thermistor.  Normally Infinity.  Or, if β is NaN, the result is ax+b with x the measured ADC value; this value is b/1000.',
								'Calibrated resistance of the thermistor.  Normally 100 for extruders, 10 for the heated bed.',
								'Temperature at which the thermistor has value Rc.  Normally 20.',
								"Temperature dependence of the thermistor.  Normally around 3800.  It can be found in the thermistor's data sheet.  Or, if β is NaN, the result is ax+b with x the measured ADC value."
							]).AddMultiple('temp', 'Temp_temp')
						])!] <!-- }}} -->

						[!([make_table().AddMultipleTitles([
						// Gpio {{{
								'Gpio',
								'Master temp',
								'Threshold(°C)'
							], [
								'htitle2',
								'title2',
								'title2'
							], [
								null,
								'If set to something other than None, the pin will automatically be set and reset depending on the value of the selected temperature control.',
								'If a master temp is set, the pin will be on if that temp is above this value, otherwise it will be off.'
							]).AddMultiple('gpio', 'Gpio_gpio')
						])!] <!-- }}} -->

						[!([make_table(elements[0], elements[1]).AddMultiple('space', 'Pins_space', false).AddMultiple('temp', 'Pins_temp', false).AddMultiple('gpio', 'Pins_gpio', false)]
						// Pins {{{
							[$(Pin ['LED', [null, 'led_pin']])$]
							[$(Pin ['Probe', [null, 'probe_pin']])$]
							)!] <!-- }}} -->

						<div>[!(elements[0].port = port, elements<button type='button' onclick="rpc.call('disable', [this.port], {})">Disable printer</button>)!]</div>
				</div> <!-- }}} -->
					<div class='queuediv'> <!-- {{{ Queue. -->
						<div>
							[!(
								elements[0].id = make_id(printer, [null, 'queue']),
								elements
								<select multiple='multiple'></select>
								<div class='queuelist'>
									<button type='button' class='queue1' onclick='queue_up()'>&#x2b06;</button>
									<span class='queue2'>[$(File [[null, 'queue_add', 'queue_add'], 'Add', queue_deselect])$]</span><br/>
									<button type='button' class='queue1' onclick='queue_del()'>×</button>
									<span class='queue2'>
										[!(
											elements[0].printer = printer,
											elements[1].id = make_id(printer, [null, 'probebox']),
											elements[2].htmlFor = elements[1].id,
											elements
											<button type='button' class='queue1' onclick='queue_print(this.printer)'>Print selected</button>
											<input type='checkbox'/>
											<label>Probe</label>
										)!]
									</span><br/>
									<button type='button' class='queue1' onclick='queue_down()'>&#x2b07;</button>
									<span class='queue2'>
										<button type='button' onclick="selected_printer.call('park', [], {}, update_canvas_and_spans)">Park</button>
										<button type='button' onclick="selected_printer.call('home', [], {}, update_canvas_and_spans)">Home</button>
										<button type='button' onclick="selected_printer.call('sleep', [], {}, update_canvas_and_spans)">Sleep</button>
									</span><br/>
									<span class='queue1'>
										[!(
											elements[0].id = make_id(printer, [null, 'status']),
											elements
											<span>Idle</span>
										)!]
									</span>
									<span class='queue2'>
										<button type='button' onclick="selected_printer.call('pause', [true], {})">Stop</button>
										<button type='button' onclick="selected_printer.call('pause', [false], {})">Resume</button>
									</span>
								</div>
							)!]
						</div>
					</div> <!-- }}} -->
					<div class='movediv' onclick='start_move()' onkeydown='if (!key_move(event.keyCode, event.shiftKey, event.ctrlKey)) event.preventDefault()'><!-- {{{ -->
						[!(
							elements[0].id = make_id(printer, [null, 'movebox']),
							elements
							<div class='movebox'>
								<p>Amount per keypress: <input value='10' class='title' type='text' id='move_amount'/></p>
								<div class='move_viewbox'>
									[!(
										elements[0].id = make_id(printer, [null, 'move_view']),
										elements
										<canvas id='move_view'></canvas>
									)!]
								</div>
								<p>[!(
									elements[0].id = make_id(printer, [null, 'movespan0']),
									elements[1].id = make_id(printer, [null, 'movespan1']),
									elements[2].id = make_id(printer, [null, 'movespan2']),
									[elements[0], ', ', elements[1], ', ', elements[2], ' mm']
									<span></span>
									<span></span>
									<span></span>
								)!]</p>
								<p>
									<!-- TODO: document position.  -->
									<button type='button' onclick="reset_position()">Reset position</button>
								</p>
							</div>
						)!]
					</div><!-- }}} -->

					[!([make_table().AddMultipleTitles([
					// Temp control {{{
							'Temp control',
							'Target (°C)',
							'Current (°C)'
						], [
							'htitle4',
							'title4',
							'title4'
						], [
							null,
							'Temperature target.  Set to NaN to disable the heater completely.',
							'Request actual temperature from sensor.'
						]).AddMultiple('temp', 'Tempcontrol_temp').AddClass('left')
					])!] <!-- }}} -->
					[!([make_table().AddMultipleTitles([
					// Axis {{{
							'Axis',
							'Go (mm)',
							'Offset (mm)'
						], [
							'htitle4',
							'title4',
							'title4'
						], [
							null,
							'Physically move the nozzle to this position.  For Z, more positive numbers move the nozzle away from the bed.',
							'Displacement of origin.  When instructed to go to a position, it will add this value to the position before going there.'
						]).AddMultiple('space', 'Move_space', false).AddClass('left')
					])!] <!-- }}} -->
					[!([make_table().AddMultipleTitles([
					// Motor {{{
							'Motor',
							'Coupling (steps/mm)'
						], [
							'htitle2',
							'title2'
						], [
							null,
							'Number of (micro)steps that the motor needs to do to move the hardware by one mm.'
						]).AddMultiple('space', 'Steps_space', false).AddClass('left')
					])!] <!-- }}} -->
					[!([make_table().AddMultipleTitles([
					// Gpio {{{
							'Gpio',
							'State',
							'Value'
						], [
							'htitle4',
							'title3',
							'title6'
						], [
							null,
							'State of the pin.',
							'Value of the pin.'
						]).AddMultiple('gpio', 'State_gpio').AddClass('left')])!] <!-- }}} -->

					<div>Feedrate: [$(Float [[null, 'feedrate'], .01])$] %</div>

					[!(
						elements[0].id = make_id(printer, [null, 'scripts']),
						elements
						<div></div>
					)!]

					<!-- Save and restore {{{ -->
					[$(Button ['Save settings to EEPROM', 'save'])$]
					[$(Button ['Restore settings from EEPROM', 'load'])$]
					<div>[$(File [[null, 'import', 'import_settings'], 'Import'])$]</div>
					<div>[!(
						elements[0].id = make_id(printer, [null, 'export']),
						stack
						<a class='title' title='Save settings to disk.'>Export settings to file</a>
					)!]</div>
					[!(
						elements[0].id = make_id(printer, [null, 'message1']),
						elements
						<div class='message'></div>
					)!]
					<!-- }}} -->
				</div>
			</div> <!-- }}} -->
			<div id='NoPrinter'> <!-- {{{ -->
				<div class='noprinter notconnected setup hidden'>
					[!(
						node.id = make_id({'port': args[0]}, [null, 'nocontainer']),
						elements[0].id = make_id({'port': args[0]}, [null, 'block2']),
						elements
						<div class='hidden blocker'></div>
					)!]
					<h2>No printer is found on this port.</h2>
					<p>
						If autodetect does not work, you can request to detect a printer:
						[!(
							elements[0].port = args[0],
							elements
							<button type='button' onclick="rpc.call('detect', [this.port], {})">Detect</button>
						)!]
					</p>
					<p>
						Or you can upload the firmware that fits your hardware.
						[!(upload_buttons(args[0], [['melzi', '1284p (Melzi, Sanguinololu)'], ['ramps', 'mega2560 (Ramps)'], ['mega', 'mega']]))!]
					</p>
					[!(
						elements[0].id = make_id({'port': args[0]}, [null, 'message2']),
						elements
						<div class='message'></div>
					)!]
				</div>
			</div> <!-- }}} -->
		</div> <!-- }}} -->
		<div id='labels'></div>
		<div id='printers'></div>
		<div id='debug'></div>
		<div id='scripts'></div>
	</body>
</html>
